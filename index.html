<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BazarPlus - Gestão de Bazares e Créditos</title>
    
    <link rel="stylesheet" href="styles.css"> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    
    <div class="app-container">
        <header class="header">
            <h1 class="logo">BazarPlus ⚡️</h1>
            <div class="user-info">
                <span>Bem-vindo, Administrador</span>
                <button class="icon-button" onclick="showTab('configuracoes', this)"><i class="fas fa-cog"></i></button>
            </div>
        </header>

        <nav class="sidebar">
            <ul class="nav-list">
                <li class="nav-item">
                    <button class="nav-button active" onclick="showTab('itens', this)">
                        <i class="fas fa-tags"></i>
                        <span>Itens</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-button" onclick="showTab('vendas', this)">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Vendas</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-button" onclick="showTab('consignatarios', this)">
                        <i class="fas fa-users"></i>
                        <span>Consignatários</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-button" onclick="showTab('compradores', this)">
                        <i class="fas fa-address-book"></i>
                        <span>Compradores</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-button" onclick="showTab('bazares', this)">
                        <i class="fas fa-store"></i>
                        <span>Bazares</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-button" onclick="showTab('relatorios', this)">
                        <i class="fas fa-chart-line"></i>
                        <span>Relatórios</span>
                    </button>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            
            <div id="itens" class="tab-content active">
                <h2><i class="fas fa-tags"></i> Gestão de Itens</h2>
                <div class="form-container card">
                    <h3>Cadastro Rápido (Ctrl+S)</h3>
                    <div class="form-grid">
                        <input type="text" id="item-nome" placeholder="Nome do Item/Lote" required>
                        <input type="number" id="item-valor" placeholder="Valor (R$)" required>
                        <select id="item-consignatario" required>
                            <option value="">Selecione o Consignatário</option>
                            </select>
                        <select id="item-bazar" required>
                            <option value="">Selecione o Bazar</option>
                            </select>
                        <input type="number" id="item-credito" placeholder="Crédito (%)" value="50" required>
                        <input type="text" id="item-codigo" placeholder="Código Único (opcional)">
                    </div>
                    <button class="btn btn-primary" onclick="adicionarItem()">
                        <i class="fas fa-plus"></i> Cadastrar Item
                    </button>
                </div>

                <div class="list-container card">
                    <h3>Itens Cadastrados</h3>
                    <div class="search-filter-bar">
                        <input type="text" id="itens-search" placeholder="Buscar por nome, código ou consignatário..." onkeyup="listarItens()">
                    </div>
                    <table id="tabela-itens">
                        <thead>
                            <tr>
                                <th>Cód.</th>
                                <th>Nome</th>
                                <th>Valor (R$)</th>
                                <th>Consignatário</th>
                                <th>Bazar</th>
                                <th>Crédito (%)</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="vendas" class="tab-content">
                <h2><i class="fas fa-shopping-cart"></i> Processar Venda</h2>
                <div class="venda-container">
                    
                    <div class="venda-input card">
                        <h3>Adicionar Item à Venda</h3>
                        <input type="text" id="venda-codigo" placeholder="Digite o Código do Item" autofocus>
                        <p id="venda-feedback" class="feedback-text"></p>
                        <div class="item-info" id="venda-item-info">
                            </div>
                        <button class="btn btn-primary" onclick="adicionarItemVenda()">
                            <i class="fas fa-cart-plus"></i> Adicionar à Lista
                        </button>
                    </div>

                    <div class="venda-finalizacao card">
                        <h3>Lista de Itens (Venda Atual)</h3>
                        <table id="tabela-venda-itens">
                            <thead>
                                <tr>
                                    <th>Cód.</th>
                                    <th>Item</th>
                                    <th>Valor</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="2">Total:</td>
                                    <td id="venda-total">R$ 0,00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>

                        <div class="finalizar-opcoes">
                            <select id="venda-comprador" required>
                                <option value="">Selecione o Comprador (Opcional)</option>
                                </select>
                            <select id="venda-bazar" required>
                                <option value="">Selecione o Bazar Atual</option>
                                </select>
                            <select id="venda-forma-pagamento" required>
                                <option value="">Forma de Pagamento</option>
                                <option value="dinheiro">Dinheiro</option>
                                <option value="cartao">Cartão</option>
                                <option value="pix">PIX</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-success" onclick="finalizarVenda()">
                            <i class="fas fa-check"></i> Finalizar Venda
                        </button>
                        <button class="btn btn-danger" onclick="limparVenda()">
                            <i class="fas fa-trash-alt"></i> Limpar Venda
                        </button>
                    </div>
                </div>
            </div>

            <div id="consignatarios" class="tab-content">
                <h2><i class="fas fa-users"></i> Gestão de Consignatários</h2>
                <div class="form-container card">
                    <h3>Cadastro (Ctrl+S)</h3>
                    <div class="form-grid">
                        <input type="text" id="consignatario-nome" placeholder="Nome do Consignatário" required>
                        <input type="text" id="consignatario-contato" placeholder="Contato (Telefone/Email)">
                        <input type="text" id="consignatario-pix" placeholder="Chave PIX">
                    </div>
                    <button class="btn btn-primary" onclick="adicionarConsignatario()">
                        <i class="fas fa-user-plus"></i> Cadastrar Consignatário
                    </button>
                </div>

                <div class="list-container card">
                    <h3>Lista de Consignatários</h3>
                    <div class="search-filter-bar">
                        <input type="text" id="consignatario-search" placeholder="Buscar por nome..." onkeyup="listarConsignatarios()">
                    </div>
                    <table id="tabela-consignatarios">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Contato</th>
                                <th>PIX</th>
                                <th>Itens Ativos</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="compradores" class="tab-content">
                <h2><i class="fas fa-address-book"></i> Gestão de Compradores</h2>
                <div class="form-container card">
                    <h3>Cadastro (Ctrl+S)</h3>
                    <div class="form-grid">
                        <input type="text" id="comprador-nome" placeholder="Nome do Comprador" required>
                        <input type="text" id="comprador-contato" placeholder="Contato (Telefone/Email)">
                    </div>
                    <button class="btn btn-primary" onclick="adicionarComprador()">
                        <i class="fas fa-user-plus"></i> Cadastrar Comprador
                    </button>
                </div>

                <div class="list-container card">
                    <h3>Lista de Compradores</h3>
                    <div class="search-filter-bar">
                        <input type="text" id="comprador-search" placeholder="Buscar por nome..." onkeyup="listarCompradores()">
                    </div>
                    <table id="tabela-compradores">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Contato</th>
                                <th>Total Gasto</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="bazares" class="tab-content">
                <h2><i class="fas fa-store"></i> Gestão de Bazares</h2>
                <div class="form-container card">
                    <h3>Criar Novo Bazar (Ctrl+S)</h3>
                    <div class="form-grid">
                        <input type="text" id="bazar-nome" placeholder="Nome do Bazar (Ex: Edição Dezembro 2024)" required>
                    </div>
                    <button class="btn btn-primary" onclick="criarBazar()">
                        <i class="fas fa-plus-circle"></i> Criar Bazar
                    </button>
                </div>

                <div class="list-container card">
                    <h3>Bazares Ativos</h3>
                    <table id="tabela-bazares">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Data de Criação</th>
                                <th>Itens Cadastrados</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="relatorios" class="tab-content">
                <h2><i class="fas fa-chart-line"></i> Relatórios e Estatísticas</h2>
                
                <div class="relatorios-grid">
                    
                    <div class="card">
                        <h3>Visão Geral do Bazar</h3>
                        <p>Bazar Ativo: <strong id="relatorio-bazar-ativo">Nenhum</strong></p>
                        <p>Total de Itens Vendidos: <strong id="relatorio-total-vendido">0</strong></p>
                        <p>Total Arrecadado (Bruto): <strong id="relatorio-arrecadado-bruto">R$ 0,00</strong></p>
                        <p>Valor Devido a Consignatários: <strong id="relatorio-devido-consignatarios">R$ 0,00</strong></p>
                        <p>Lucro do Bazar: <strong id="relatorio-lucro-bazar">R$ 0,00</strong></p>
                        <button class="btn btn-info" onclick="gerarRelatorioVendasPDF()">
                            <i class="fas fa-file-pdf"></i> Gerar Relatório de Vendas (PDF)
                        </button>
                    </div>

                    <div class="card">
                        <h3>Créditos por Consignatário</h3>
                        <table id="tabela-relatorio-consignatarios" class="tabela-relatorio">
                            <thead>
                                <tr>
                                    <th>Consignatário</th>
                                    <th>Total Devido</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>

                    <div class="card full-width">
                        <h3>Detalhe de Itens Vendidos por Consignatário</h3>
                        <select id="relatorio-consignatario-select" onchange="listarItensVendidosPorConsignatario()">
                            <option value="">Selecione um Consignatário</option>
                            </select>
                        <table id="tabela-itens-vendidos-detalhe" class="tabela-relatorio">
                            <thead>
                                <tr>
                                    <th>Cód.</th>
                                    <th>Item</th>
                                    <th>Valor Venda</th>
                                    <th>% Crédito</th>
                                    <th>Crédito Consignatário</th>
                                    <th>Comprador</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                        <button class="btn btn-info" onclick="gerarRelatorioConsignatarioPDF()">
                            <i class="fas fa-file-pdf"></i> Gerar Relatório Detalhado (PDF)
                        </button>
                    </div>

                    <div class="card full-width">
                        <h3>Gráfico de Vendas (Forma de Pagamento)</h3>
                        <canvas id="vendasChart"></canvas>
                    </div>

                </div>
            </div>

            <div id="configuracoes" class="tab-content">
                <h2><i class="fas fa-cog"></i> Configurações e Backup</h2>
                <div class="config-grid">
                    <div class="card">
                        <h3>Exportar Dados (Backup)</h3>
                        <p>Exporta todos os dados (Itens, Consignatários, Vendas, etc.) para um arquivo JSON.</p>
                        <button class="btn btn-warning" onclick="exportarDados()">
                            <i class="fas fa-download"></i> Exportar Agora (Ctrl+E)
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3>Importar Dados (Restauração)</h3>
                        <p>Importa dados de um arquivo JSON. **ATENÇÃO:** Isso substituirá os dados atuais!</p>
                        <input type="file" id="import-file" accept=".json">
                        <button class="btn btn-danger" onclick="importarDados()">
                            <i class="fas fa-upload"></i> Importar Dados
                        </button>
                    </div>

                    <div class="card">
                        <h3>Resetar/Limpar Tudo</h3>
                        <p>Apaga TODOS os dados do Local Storage (Itens, Consignatários, Vendas, Bazares).</p>
                        <button class="btn btn-danger" onclick="limparTudo()">
                            <i class="fas fa-trash-alt"></i> Limpar Tudo
                        </button>
                    </div>

                    <div class="card">
                        <h3>Inicializador de Dados</h3>
                        <p>Cria um bazar inicial, um consignatário e um comprador de exemplo.</p>
                        <button class="btn btn-info" onclick="executarInicializador()">
                            <i class="fas fa-magic"></i> Executar Inicializador
                        </button>
                    </div>

                </div>
            </div>
            
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
